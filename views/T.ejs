<!DOCTYPE html>

<div class="container-fluid">
  <div class="row-fluid">
    <div  class="span12">
      <div class="tabbable">
        <ul class="nav nav-tabs" id="tabs">
          <li>
            <a data-toggle="tab" style="cursor:pointer">Feature Model</a>
          </li>
          <li  class="active">
            <a data-toggle="tab" style="cursor:pointer">Traceability</a>
          </li>
          <li>
            <a data-toggle="tab"  style="cursor:pointer">Configuration</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
<style>
    div.c{padding-left:1%}
    div.left{float:left;width:20%;margin:6px;border:1px solid #c3c3c3;border-radius: 10px;}
    div.center{float:left;width:50%;margin:6px;border:1px solid #c3c3c3;border-radius: 10px;}
    div.right{float:left;width:25%;margin:6px;border:1px solid #c3c3c3;border-radius: 10px;}
    /*min-height: 500px;*/
    div.titles{
      text-align: center;
      font-size: 125%;
      font-weight: bold;
      margin-top: 12px;
      font-family: "David";
    }

    div.ostitles{
      text-align: center;
      font-size: 115%;
      font-weight: bold;
      margin-top: 8px;
      font-family: "David";
    }

    .myh4 {
      font-family:"Calibri";
      font-size:125%;
    }

    h4{
      color: #000000
    }

    h5{
      font-weight: normal;
    }
    .myInside {
      border-top:1px solid #c3c3c3;
      overflow:auto;
      color: #000000;
      height: 32px; 
    }


    .myInsideA {
      border-top:1px solid #c3c3c3;
      overflow:auto;
      color: #000000;
      height: 32px; 
    }


    .myInsidePlus {
      border-top:1px solid #c3c3c3;
      overflow:auto;
      color: #000000;
      height: 32px; 

    }

    .focusBgColor{
      background-color: #c3c3c3;
    }

    .group { zoom: 1 }

    .depnInside{
      border-top:1px solid #c3c3c3;
    }

    .getFocus{
      border:1px solid #c3c3c3;
    }

    .GuardListStyle{float:right;margin-right:6px;margin-top:10px;display:none;}
</style>

<script type="text/javascript">
  var $seq_no=0;
  var $current_guard_id;
  var $current_accordion;
  function update_pageT()
  {
    window.location.href("/T");
  }

  $(function(){
      $("#guardNameShow").mouseover(function(){
        $(this).find("i").show();
      })

      $("#guardNameShow").mouseout(function(){
        $(this).find("i").hide();
      })

      $(".myInsideA").mouseover(function(){
          $(this).children().show();
      })
      $(".myInsideA").mouseout(function(){
          $(this).children().hide();
      })

      $("h4").mouseover(function(){
          $(this).children().show();
      })
      $("h4").mouseout(function(){
          $(this).children().hide();
      })

      $(".icon-pencil.editOperation").click(function(){
        jQuery.each($(this).parent().parent().parent(),function(){
          $(this).find('input').attr("readonly",false);
          $(this).find('textarea').attr("readonly",false);
        })
        //$(this).parent().parent().parent().('input').attr("readonly",false);
         $(this).css("display","none");
         $(this).siblings().show();
      })

      $(".icon-ok.editOperation").click(function(){
        jQuery.each($(this).parent().parent().parent(),function(){
          $(this).find('input').attr("readonly",true);
          $(this).find('textarea').attr("readonly",true);
        })
         $(this).css("display","none");
         $(this).siblings().show();
      })

      $(".icon-pencil.GuardListStyle").click(function(event){
        $current_guard_id=$(this).parent().attr('name');
        $( "#editSelfName" ).dialog( "open" );
        event.stopPropagation(); 
      })

      $(".myInsideA").click(function(){
        if($(this).attr('name')!=null){
          window.location.href="/T/"+$(this).attr('name');
        }
      })

      $(".icon-remove").click(function(){
        //alert($(this).parent().get(0).text);
        alert($(this).parent().attr('name'));

        $.ajax({
            type: "POST",
            url: "/del",
            data: {
              
              featurename:$(this).parent().attr('name'), 

              types:1
           },
            dataType:'json',
          });
        $(this).parent().remove();
      })
    

      $(".myInsideA").each(function(index){
          $(this).click(function(){
            $(".myInsideA.focusBgColor").removeClass("focusBgColor");
            $(this).addClass("focusBgColor");
          })
        })

      $(".icon-pencil").mouseover(function(){
        $(this).addClass("getFocus");
      })

      $(".icon-pencil").mouseout(function(){
        $(this).removeClass("getFocus");
      })

       $(".icon-remove").mouseover(function(){
        $(this).addClass("getFocus");
      })

      $(".icon-remove").mouseout(function(){
        $(this).removeClass("getFocus");
      })

      $(".icon-plus").mouseover(function(){
        $(this).addClass("getFocus");
      })

      $(".icon-plus").mouseout(function(){
        $(this).removeClass("getFocus");
      })

      $(".icon-plus").click(function(){
        $current_accordion=$(this).parent().parent().parent().attr("id");
        $( "#addOperation" ).dialog( "open" );
        event.stopPropagation();
      })

      $(".icon-ok").mouseover(function(){
        $(this).addClass("getFocus");
      })

      $(".icon-ok").mouseout(function(){
        $(this).removeClass("getFocus");
      })

      $(".icon-minus").mouseover(function(){
        $(this).addClass("getFocus");
      })

      $(".icon-minus").mouseout(function(){
        $(this).removeClass("getFocus");
      })

      $(".icon-minus").click(function(){
        $(this).parent().remove();
      })

      $( "#radio" ).buttonset();
    // Add Accordion stuff
    $(".accordion").accordion({
      autoHeight: false,
      active: false,
      collapsible: true
    }); // end $(".accordion").accordion

    // Add sortables
    $('.sortable').sortable({
      start: function(e, ui) {
        container = $(e.target);

        var parent_id = container.parent().parent().attr('id');
        expanded_ones = new Array();
        var count = 0;
        var summary = '';
        var child = '';
        var active = '';

        // now close all other sections
        $.each($('#' + parent_id + ' .accordion'), function() {
          // get the child element since that has the div id I need
          child = $(this).children('div');

          // get the active information to see if it is open or closed
          active = $(this).accordion('option', 'active');

          // check to see if this one is expanded
          if(parseInt(active) == active) {
            // store this id so we can open it later
            expanded_ones[count] = $(child).attr('id');
            count++;

            // and close the accordion
            $(this).accordion({ active: false });
          } // end if(parseInt(active) == active)
        }); // end $.each($('#' + parent_id + ' .accordion'), function()
      }, // end start: function(e, ui)
      stop: function(e, ui) {
        container = $(e.target);

        var parent_elem = '';

        // expand the ones that were originally expanded
        for(var i = 0; i < expanded_ones.length; i++) {
          parent_elem = $('#' + expanded_ones[i]).parent();
          $(parent_elem).accordion('option', 'active', 0);
        } // end for(var i = 0; i < expanded_ones; i++)
      } // end stop: function(e, ui)
    }); // end $('.sortable').sortable

        var guardname=$("#guardname");
        var $tracerules;
        var $selfName;
        
        var $str;

        var $TDLType;

        var $activityname;
        var $activitydescription;
        var $activityexecutor;
        var $activityvirtual;

        $( "#dialog-form" ).dialog({
          autoOpen: false,
          width: 450,
          modal: true,
          buttons: {

            "Confirm": function() {
            $(".nav-list-1:last").remove();

              $selfName=$("#selfDescription").val();

              $str="";
              $('input[name="featurename"]:checked').each(function(){
                
              if($str != "")
              {
                $str=$str+"&nbsp;∨&nbsp;";
              }
              var $val=$('input:radio[name=\"'+$(this).val()+'\"]:checked').val();
              if($val != "no")
                $str=$str+"⌉";
    
              $str=$str+$(this).val();
            })
            
            $("#guardlist").append("<li class=\"nav-list-1\"><a href=\"javascript:;\" class=\"myInside\">"+$selfName+"<i class=\"icon-remove GuardListStyle\" ></i></a></li>").find('.myInside').mouseover(function(){$(this).children().show();}).mouseout(function(){$(this).children().hide();}).each(function(index){$(this).click(function(){$(".myInside.focusBgColor").removeClass("focusBgColor");$(this).addClass("focusBgColor");})}).find('.icon-remove').mouseover(function(){$(this).addClass("getFocus");}).mouseout(function(){$(this).removeClass("getFocus");}).click(function(){$(this).parent().remove();});

            
            $("#guardlist").append("<li class=\"nav-list-1\"><a href=\"javascript:;\" class=\"myInsidePlus\" style=\"text-align:center;margin-bottom:0px;vertical-align:middle;\"><i class=\"icon-plus-sign\"></i></a></li>").find('.icon-plus-sign').click(function(){$( "#dialog-form" ).dialog( "open" );});

            $( this ).dialog( "close" );
          
        },
      },
      close: function() {
        if($str!=null){
          $.ajax({
            type: "POST",
            url: "/post",
            data: {
              selfName:$selfName,
              featurename:$str, 
              types:1
           },
            dataType:'json',
           success: function(msg){
              alert( "Data Saved: " + msg );
            }
          });
        }
      }
    });

      $( "#editSelfName" ).dialog({
          autoOpen: false,
          width: 450,
          modal: true,
          buttons: {

            "Confirm": function() {
              $selfname=$("#selfname").val();
              $( this ).dialog( "close" );
          
        },
      },
      close: function() {
        window.location.href="/doT/"+$selfname+"分<%=tracerules[0].user%>"+"分<%=tracerules[0].name%>"+"分<%=tracerules[0]._id%>分"+$current_guard_id;
      }
    });
 
      $( "#addOperation" ).dialog({
          autoOpen: false,
          width: 700,
          modal: true,
          buttons: {

            "Confirm": function() {
              $TDLType=$('input:radio[name=TDLType]:checked').val();
              $( this ).dialog( "close" );
          
        },
      },
      close: function() {
        //window.location.href="/doT/"+$selfname+"分<%=tracerules[0].user%>"+"分<%=tracerules[0].name%>"+"分<%=tracerules[0]._id%>分"+$current_guard_id;
        switch($TDLType){
          case "C1":
            alert($TDLType);
            break;
          case "C2":
            $( "#CreateActivity" ).dialog( "open" );
            break;
          case "C3":
            alert($TDLType);
            break;
          case "C4":
            alert($TDLType);
            break;
          case "I1":
            alert($TDLType);
            break;
          case "I1":
            alert($TDLType);
            break;
          case "I2":
            alert($TDLType);
            break;
          case "I3":
            alert($TDLType);
            break;
          case "I4":
            alert($TDLType);
            break;
          case "I5":
            alert($TDLType);
            break;
          case "I6":
            alert($TDLType);
            break;
          case "I7":
            alert($TDLType);
            break;
          case "I8":
            alert($TDLType);
            break;
          case "I9":
            alert($TDLType);
            break;
          case "F":
            alert($TDLType);
            break;
          default:
            break;
        }
      }
    });

     $( "#CreateActivity" ).dialog({
          autoOpen: false,
          width: 450,
          modal: true,
          buttons: {

            "Confirm": function() {
              
              $( this ).dialog( "close" );
          
        },
      },
      close: function() {
        //window.location.href="/doT/"+$selfname+"分<%=tracerules[0].user%>"+"分<%=tracerules[0].name%>"+"分<%=tracerules[0]._id%>分"+$current_guard_id;
        $activityname=$("#activityname").val();
        $activitydescription=$("#activitydescription").val();
        $activityexecutor=$('input:radio[name=ExecutorType]:checked').val();
      }
    });

    $( ".icon-plus-sign" )
      .click(function() {
        $( "#dialog-form" ).dialog( "open" );
      });

  })

</script>
 <!-- add guard --> 
<div id="dialog-form" title="Create new guard">
  
  <form>
    <fieldset id="dialog-exchange">
      
        <%- partial('guardChoice', {posts:posts}) %>
       
    </fieldset>
  </form>

</div>

 <!-- 编辑guard自定义名字 --> 
<div id="editSelfName" title="Edit Name">
  
  <form>
    <fieldset id="dialog-exchange">
       <label class="control-label" for="selfname">Guard Name：</label>
        <input type="text" class="input-xlarge" id="selfname" name="selfname">
    </fieldset>
  </form>

</div>

 <!-- 增加操作 --> 
<div id="addOperation" title="Create Operation">
  
  <form>
    <fieldset id="dialog-exchange">
       <label class="control-label" for="selfname"><h4>Chose the TDL type：</h4></label>
       <div style="margin-left:5%">

        <HR style="FILTER: progid:DXImageTransform.Microsoft.Glow(color=#987cb9,strength=10)" width="100%" color=#987cb9 SIZE=1>

          <label class="radio">
            <input type="radio" name="TDLType" id="TDLType1" value="C1" checked>
            Create use case
          </label>
          <label class="radio">
            <input type="radio" name="TDLType" id="TDLType2" value="C2">
            Create Activity
          </label>
          <label class="radio">
            <input type="radio" name="TDLType" id="TDLType3" value="C3">
            Create Decision
          </label>
          <label class="radio">
            <input type="radio" name="TDLType" id="TDLType4" value="C4">
            Create Condition
          </label>
        
        <HR style="FILTER: progid:DXImageTransform.Microsoft.Glow(color=#987cb9,strength=10)" width="100%" color=#987cb9 SIZE=1>

          <label class="radio">
            <input type="radio" name="TDLType" id="TDLType5" value="I1">
            Insert <b>sequence</b> between <b>pre-activity</b>, <b>post-activity</b> in <b>use case</b>
          </label>

        <label class="radio">
          <input type="radio" name="TDLType" id="TDLType6" value="I2">
           Insert <b>sequence</b> after <b>pre-activity</b> in <b>use case</b>
        </label>

        <label class="radio">
          <input type="radio" name="TDLType" id="TDLType7" value="I3">
           Insert <b>sequence</b> before <b>post-activity</b> in <b>use case</b>
        </label>

        <label class="radio">
          <input type="radio" name="TDLType" id="TDLType8" value="I4">
           Insert <b>sequence</b> after <decision, condition> in <b>use case</b>
        </label>

        <label class="radio">
          <input type="radio" name="TDLType" id="TDLType9" value="I5">
           Insert <b>sequence</b> before <decision, condition> in <b>use case</b>
        </label>

        <HR style="FILTER: progid:DXImageTransform.Microsoft.Glow(color=#987cb9,strength=10)" width="100%" color=#987cb9 SIZE=1>

        <label class="radio">
          <input type="radio" name="TDLType" id="TDLType10" value="I6">
            Insert <decision> after <b>pre-activity</b> with (c1,s1), (c2,s2,pa2) ,…, (cn,sn,pan) in <b>use case</b>
        </label>

        <label class="radio">
          <input type="radio" name="TDLType" id="TDLType11" value="I7">
           Insert <decision> before <b>post-activity</b> with (c1,s1), (c2,s2,pa2) ,…, (cn,sn,pan) in <b>use case</b>
        </label>

        <label class="radio">
          <input type="radio" name="TDLType" id="TDLType12" value="I8">
           Insert <decision> after <b>post-activity</b> with (c1,s1), (c2,s2,pa2) ,…, (cn,sn,pan) in <b>use case</b>
        </label>

        <label class="radio">
          <input type="radio" name="TDLType" id="TDLType13" value="I9">
           Insert <decision> before <b>post-activity</b>, <condition> with (c1,s1), (c2,s2,pa2) ,…, (cn,sn,pan) in <b>use case</b>
        </label>

        <HR style="FILTER: progid:DXImageTransform.Microsoft.Glow(color=#987cb9,strength=10)" width="100%" color=#987cb9 size=0.5>

        <label class="radio">
          <input type="radio" name="TDLType" id="TDLType14" value="F">
          Fill <b>virtual activity sequence</b> with <b>activity sequence</b> in <b>use case</b>
        </label>
      </div>
    </fieldset>
  </form>

</div>

 <!-- Create Activity --> 
<div id="CreateActivity" title="Create Activity">
  
   <form class="form-horizontal">
    <div class="control-group">
      <label class="control-label" for="activityname">Name:</label>
        <div class="controls">
          <input type="text" id="activityname" style="width:100" placeholder="">
        </div>
    </div>
    <div class="control-group">
      <label class="control-label" for="activitydescription">Description:</label>
        <div class="controls">
          <textarea name="activitydescription" rows="3" cols="10" style="resize:none"></textarea>
        </div>
    </div>
    <div class="control-group">
      <label class="control-label" for="activityexecutor">Executor:</label>
        <div class="controls">        
            <input type="radio" name="ExecutorType" id="Executor1" value="System" checked>
            System
            &nbsp;&nbsp;
            <input type="radio" name="ExecutorType" id="Executor2" value="User">
            User          
        </div>
    </div>
    <div class="control-group">
      <label class="control-label" for="activityvirtual">Virtual:</label>
        <div class="controls">
          <label class="checkbox">
            <input type="checkbox" value="">
              true
          </label>
        </div>
    </div>
   </form>

</div>


<div class="c">
  <div class="left">
   <div class="myBorderRadius">
    <div class="titles">
      Trace Rule List
    </div>
    <div class="myh4" style="margin-top:8px">
      
      <ul class="nav nav-list" id="guardlist">
        <%- partial('guardList', {current_guard:current_guard,guardlists:guardlists}) %>
        <li class="nav-list-1"><a href="javascript:;" class="myInsidePlus" style="text-align:center;margin-bottom:0px;vertical-align:middle;"><i class="icon-plus-sign"></i></a></li>
      </ul>


    </div>
   </div>
  </div>
  
  <div class="center">

   <%- partial('operationSequence', {current_guard:current_guard,tracerules:tracerules}) %>
  </div>
  
  <div class="right">
   <div class="myBorderRadius">
    <div class="titles">
      Dependency
    </div>

      <div class="myh4" style="margin-top:8px">

        <table class="table" contenteditable="true">
  
          <tr>
           <td></td>
           <td>A5</td>
           <td><b>---></b></td>
           <td>A4&nbsp;<b>∈</b>&nbsp;Message</td>
          </tr>
          
          <tr>
           <td></td>
           <td>A7</td>
           <td><b>---></b></td>
           <td>A8&nbsp;<b>∈</b>&nbsp;Message Edit&Login</td>
          </tr>
        </table>
    
      </div>
    </div>
  </div>
</div>
